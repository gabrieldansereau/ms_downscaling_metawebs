## Methods

Fig. **¿fig:conceptual?** shows a conceptual overview of the
methodological steps. The components were grouped as the inputs (spatial
or non-spatial), the localized steps (divided into single-species-level,
two-species-level, and network-level steps), and the final spatial
output.

### Inputs

The inputs were divided into two main categories: the spatial and
non-spatial ones (*Inputs* box on Fig. **¿fig:conceptual?**).

The main building block for the interaction data was the metaweb for
Canadian mammals from @Strydom2022FooWeb, a non-spatial input
(represented as nodes and links on Fig. **¿fig:conceptual?**). As stated
above, a metaweb contains all the possible interactions between the
species found in a given regional species pool [@Dunne2006NetStr]. The
species list for the Canadian metaweb was extracted from the
International Union for the Conservation of Nature (IUCN) checklist
[@Strydom2022FooWeb]. Briefly, the metaweb was developed using graph
embedding and phylogenetic transfer learning based on the metaweb of
European mammals, which is itself based on a comprehensive survey of
interactions reported in the scientific literature
[@Maiorano2020TetSpe]. The Canadian metaweb is probabilistic, which has
the advantage of taking into account that species do not necessarily
interact whenever they co-occur [@Blanchet2020CoOcc]. However, the
Canadian metaweb is not explicitly spatial: it only gives information on
interactions in Canada as a whole and does not represent networks at
specific locations. Local networks, on the other hand, are realizations
from the metaweb resulting from sorting the species and the interactions
[@Poisot2015SpeWhy]. A spatial and localized metaweb is not equivalent
to the local networks, as it will have a different structure and a
higher connectance [@Strydom2022PreMet]. Therefore, producing a spatial
metaweb requires additional steps to account for species composition and
interaction variability in space.

The spatial data used to develop the spatial component of the metaweb
were species occurrences and environmental data. First, I extracted
species occurrences from the Global Biodiversity Information Facility
(GBIF; www.gbif.org) for the Canadian mammals using `GBIF.jl`
[@Dansereau2021SimJl]. Since GBIF observations represent presence-only
data and most predictive models require absence data, I generated
pseudo-absence data using the surface range envelope method available in
`SimpleSDMLayers.jl` [@Dansereau2021SimJl]. This method generates
pseudo-absences by selecting random non-observed locations within the
spatial range delimited by the presence data [@Barbet-Massin2012SelPse].
Then, I used environmental data and species distribution models [SDMs,
@Guisan2005PreSpe] to predict the distribution of Canadian mammals
across the whole country. The environmental data I used were the 19
standard BIOCLIM climate variables from WorldClim 2.0 [@Fick2017WorNew]
and the 12 consensus land cover variables from EarthEnv
[@Tuanmu2014Glo1km]. The climate variables represent various measures of
temperature and precipitation (e.g., annual ranges, monthly maximum or
minimum, seasonality) and are available for land areas across the globe.
Therefore, they can be used to capture the climatic tolerance of species
and model habitat suitability in new locations. The WorldClim data are
available at various resolutions. I decided to use the 2.5 arcmin
resolution (around 4.5 km at the Equator) as a compromise to catch
potential local variations while limiting computation costs to a
manageable level. The land cover variables represent classes such as
Evergreen broadleaf trees, Cultivated and managed vegetation,
Urban/Built-up, and Open Water. Values range between 0 and 100 and
represent the consensus prevalence of each class in percentage within a
pixel at a 1-km resolution. Since this is finer than the resolution for
the climate data, I coarsened the land cover ones to the same 2.5 arcmin
resolution using @GDAL/OGRcontributors2021GdaOgr.

Our selection criteria for choosing an SDM algorithm was to have a
method that generated probabilistic results, including both a
probability of occurrence for a species in a specific location and the
uncertainty associated with the prediction. These were crucial to
obtaining a probabilistic version of the metaweb as they were used to
create spatial variations in the localized interaction probabilities
(see next section). One promising method for this is Gradient Boosted
Trees with a Gaussian maximum likelihood from the `EvoTrees.jl` *Julia*
package (https://github.com/Evovest/EvoTrees.jl). This method returns a
prediction for every pixel with an average value and a standard
deviation, which I used as a measure of uncertainty to build a Normal
distribution for the probability of occurrence of a given species at all
pixels (represented as probability distributions on
Fig. **¿fig:conceptual?**).

### Localized steps

The next part of the method was the localized steps which produce local
metawebs in every pixel. This component was divided into single-species,
two-species, and network-level steps (*Localized steps* box on
Fig. **¿fig:conceptual?**).

The single-species steps represented four possible ways to account for
uncertainty in the species distributions and bring variation to the
spatial metaweb. I explored four different options to select a value
from the occurrence distributions obtained in the previous steps (Inputs
section): 1) taking the mean from the distribution as the probability of
occurrence (option 1 on Fig. **¿fig:conceptual?**); 2) converting the
mean value to a binary one using a specific threshold per species
(option 2); 3) sampling a random value within the Normal distribution
(option 3); 4) converting the random value into a binary result (option
4). The threshold ($\tau$ on Fig. **¿fig:conceptual?**) used was the
value that maximized Youden's *J* informedness statistic
[@Youden1950IndRat], the same metric used by @Strydom2022FooWeb at an
intermediate step while building the metaweb. The four sampling options
were intended to explore how uncertainty and variation in the species
distributions can affect the metaweb result and reproduce some of the
filterings that create the local network realizations
[@Poisot2015SpeWhy]. I expected thresholding to have a more pronounced
effect on network structure as it should reduce the number of links by
removing many of the rare interactions [@Poisot2016StrPro]. Meanwhile, I
expected random sampling to create spatial heterogeneity compared to the
mean probabilities, as including some extreme values should disrupt the
potential effects of environmental gradients.

Next, the two-species steps aimed to give the probability of observing a
given interaction in a location. For all species pairs, I multiplied the
two species' occurrence probability obtained using the sampling options
described in the previous paragraph, then multiplied the co-occurrence
probability by the interaction probability from the Canadian metaweb.

The network-level steps then created the probabilistic metaweb for the
location. I assembled all the local interaction probabilities (from the
two-species steps) into a probabilistic network [*sensu*
@Poisot2016StrPro]. I then sampled several random network realizations
to represent the potential local realization process
[@Poisot2015SpeWhy]. Finally, this resulted in a distribution of
localized networks, which I averaged over the number of simulations to
obtain a probabilistic network.

### Outputs and additional steps

The final output of my method was the spatial probabilistic metaweb,
which contains a localized probabilistic metaweb in every cell across
the student extent (Outputs box on Fig. **¿fig:conceptual?**). This
gives us an idea of the possible networks in all locations as the
metaweb essentially serves to set an upper bound on the potential
interactions [@Strydom2022PreMet], but with the added benefit of
accounting for co-occurrence probabilities in this case. From there, I
can create maps of network properties (e.g. number of links,
connectance) measured on the local realizations, display their spatial
distribution, and compute some community-level measures such as species
richness. Importantly, I can also calculate the uncertainty associated
with the network and community measurements and contrast their spatial
distribution. I computed uncertainty for species richness by summing the
standard deviations of the species occurrence probabilities. For
networks, I computed link variance based on the link probabilities
according to @Poisot2016StrPro. I then contrasted their spatial
distributions to identify areas where their uncertainty matches. These
would either indicate that we should trust the predictions (if the
uncertainty is low) or need more sampling (if the uncertainty is high)
to improve our current knowledge. On the other hand, identifying areas
where the richness and link uncertainty do not match would also be
highly informative. It could lead to targeted sampling programs for
either component (community or network composition).

I compared the compositional uniqueness of the networks and the
communities to verify if they indicated different exceptional areas. I
measured uniqueness using the local contributions to beta diversity
[LCBD, @Legendre2013BetDiv], which identify sites with exceptional
composition by quantifying how much one site contributes to the total
variance in the community composition. While many studies used LCBD
values to evaluate uniqueness on local scales or few study sites [for
example, @daSilva2014LocReg; @Heino2017ExpSpe], recent studies used the
measure on predicted species compositions over broad spatial extents and
a large number of sites [@Vasconcelos2018ExpImp; @Dansereau2022EvaEco].
LCBD values can also be used to measure uniqueness for networks by
computing the values over the adjacency matrix, which has been shown to
capture more unique sites and uniqueness variability than through
species composition [@Poisot2017HosPar]. Here, I measured and compared
the uniqueness of our localized community and network predictions. I was
especially interested in seeing if the sites identified as unique were
the same based on the species and the interactions or if this method
allowed identifying areas unique for one element (interactions, for
instance) but not the other. Sites with such mismatches should warrant
more investigation to understand the reasons for this difference.
